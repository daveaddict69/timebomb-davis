local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Debris = game:GetService("Debris")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer
local TELEPORT_DISTANCE = 5.5
local DETECTION_RADIUS = 12.5
local COOLDOWN = 0.3
local JUMP_HEIGHT = 8

local lastActionTime = 0
local isTeleporting = false
local gotoEnemies = true
local autoDodge = true
local guiVisible = true

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "davisly"
screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 250, 0, 180)
mainFrame.Position = UDim2.new(0.02, 0, 0.02, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
mainFrame.BorderSizePixel = 2
mainFrame.BorderColor3 = Color3.fromRGB(0, 170, 255)
mainFrame.Parent = screenGui

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0.2, 0)
title.BackgroundTransparency = 1
title.Text = "DAVISLY V2"
title.TextColor3 = Color3.fromRGB(0, 200, 255)
title.Font = Enum.Font.GothamBold
title.TextSize = 22
title.Parent = mainFrame

local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0, 30, 0, 30)
closeButton.Position = UDim2.new(1, -35, 0, 5)
closeButton.BackgroundColor3 = Color3.fromRGB(255, 60, 60)
closeButton.Text = "X"
closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
closeButton.Font = Enum.Font.GothamBold
closeButton.TextSize = 18
closeButton.Parent = mainFrame

local openButton = Instance.new("TextButton")
openButton.Size = UDim2.new(0, 40, 0, 40)
openButton.Position = UDim2.new(0, 5, 0, 5)
openButton.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
openButton.Text = "OPEN"
openButton.TextColor3 = Color3.fromRGB(255, 255, 255)
openButton.Font = Enum.Font.GothamBold
openButton.TextSize = 14
openButton.Visible = false
openButton.Parent = screenGui

local status = Instance.new("TextLabel")
status.Size = UDim2.new(1, -20, 0.15, 0)
status.Position = UDim2.new(0, 10, 0.25, 0)
status.BackgroundTransparency = 1
status.Text = "Status: Active"
status.TextColor3 = Color3.fromRGB(0, 255, 0)
status.Font =Enum.Font.Gotham
status.TextSize = 16
status.Parent = mainFrame

local gotoFrame = Instance.new("Frame")
gotoFrame.Size = UDim2.new(1, -20, 0.2, 0)
gotoFrame.Position = UDim2.new(0, 10, 0.45, 0)
gotoFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
gotoFrame.BorderSizePixel = 0
gotoFrame.Parent = mainFrame

local gotoText = Instance.new("TextLabel")
gotoText.Size = UDim2.new(0.6, 0, 1, 0)
gotoText.BackgroundTransparency = 1
gotoText.Text = "Goto Enemies"
gotoText.TextColor3 = Color3.fromRGB(255, 255, 255)
gotoText.Font = Enum.Font.Gotham
gotoText.TextSize = 16
gotoText.Parent = gotoFrame

local gotoSwitch = Instance.new("TextButton")
gotoSwitch.Size = UDim2.new(0.3, 0, 0.7, 0)
gotoSwitch.Position = UDim2.new(0.65, 0, 0.15, 0)
gotoSwitch.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
gotoSwitch.Text = "ON"
gotoSwitch.TextColor3 = Color3.fromRGB(255, 255, 255)
gotoSwitch.Font = Enum.Font.GothamBold
gotoSwitch.TextSize = 14
gotoSwitch.Parent = gotoFrame

local dodgeFrame = Instance.new("Frame")
dodgeFrame.Size = UDim2.new(1, -20, 0.2, 0)
dodgeFrame.Position = UDim2.new(0, 10, 0.7, 0)
dodgeFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
dodgeFrame.BorderSizePixel = 0
dodgeFrame.Parent = mainFrame

local dodgeText = Instance.new("TextLabel")
dodgeText.Size = UDim2.new(0.6, 0, 1, 0)
dodgeText.BackgroundTransparency = 1
dodgeText.Text = "Auto Dodge"
dodgeText.TextColor3 = Color3.fromRGB(255, 255, 255)
dodgeText.Font = Enum.Font.Gotham
dodgeText.TextSize = 16
dodgeText.Parent = dodgeFrame

local dodgeSwitch = Instance.new("TextButton")
dodgeSwitch.Size = UDim2.new(0.3, 0, 0.7, 0)
dodgeSwitch.Position = UDim2.new(0.65, 0, 0.15, 0)
dodgeSwitch.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
dodgeSwitch.Text = "ON"
dodgeSwitch.TextColor3 = Color3.fromRGB(255, 255, 255)
dodgeSwitch.Font = Enum.Font.GothamBold
dodgeSwitch.TextSize = 14
dodgeSwitch.Parent = dodgeFrame

closeButton.MouseButton1Click:Connect(function()
    mainFrame.Visible = false
    openButton.Visible = true
    guiVisible = false
end)

openButton.MouseButton1Click:Connect(function()
    mainFrame.Visible = true
    openButton.Visible = false
    guiVisible = true
end)

gotoSwitch.MouseButton1Click:Connect(function()
    gotoEnemies = not gotoEnemies
    if gotoEnemies then
        gotoSwitch.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
        gotoSwitch.Text = "ON"
        status.Text = "Goto: ON"
    else
        gotoSwitch.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
        gotoSwitch.Text = "OFF"
        status.Text = "Goto: OFF"
    end
end)

dodgeSwitch.MouseButton1Click:Connect(function()
    autoDodge = not autoDodge
    if autoDodge then
        dodgeSwitch.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
        dodgeSwitch.Text = "ON"
        status.Text = "Dodge: ON"
    else
        dodgeSwitch.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
        dodgeSwitch.Text = "OFF"
        status.Text = "Dodge: OFF"
    end
end)

local function findSafePosition(startPos, targetPos)
    local directions = {
        Vector3.new(1, 0, 0),   -- Right
        Vector3.new(-1, 0, 0),  -- Left
        Vector3.new(0, 0, 1),   -- Forward
        Vector3.new(0, 0, -1),  -- Backward
        Vector3.new(0.7, 0, 0.7),   -- Diagonal right forward
        Vector3.new(-0.7, 0, 0.7),  -- Diagonal left forward
        Vector3.new(0.7, 0, -0.7),  -- Diagonal right backward
        Vector3.new(-0.7, 0, -0.7)  -- Diagonal left backward
    }
    
    for i, dir in ipairs(directions) do
        local checkPos = startPos + (dir * TELEPORT_DISTANCE)
        checkPos = Vector3.new(checkPos.X, startPos.Y, checkPos.Z)
        
        local ray1 = workspace:Raycast(startPos, dir * TELEPORT_DISTANCE)
        if not ray1 or not ray1.Instance or not ray1.Instance.CanCollide then
            local ray2 = workspace:Raycast(checkPos + Vector3.new(0, 1, 0), Vector3.new(0, -3, 0))
            if ray2 and ray2.Instance and ray2.Instance.CanCollide then
                return checkPos, dir
            end
        end
    end
    
    return startPos, Vector3.new(0, 1, 0)
end

local function E(F)
    local G=tick()
    if G-lastActionTime<COOLDOWN then return end
    if not gotoEnemies then return end
    local H=LocalPlayer.Character
    if not H then return end
    local I=H:FindFirstChild("HumanoidRootPart")
    if not I then return end
    local J=H:FindFirstChild("Humanoid")
    if not J then return end
    
    isTeleporting = true
    status.Text = "Teleporting..."
    
    local K=I.Position
    local L=(F-K).Unit
    
    local M, N = findSafePosition(K, F)
    
    if (M - K).Magnitude < 1 then
        status.Text = "Blocked"
        isTeleporting = false
        return
    end
    
    I.CFrame = CFrame.new(M, M + N)
    
    task.wait(0.1)
    if gotoEnemies then
        J.Jump=true
    end
    
    lastActionTime=G
    
    local P=Instance.new("Part")
    P.Size=Vector3.new(1, 1, 1)
    P.Position=K
    P.Anchored=true
    P.CanCollide=false
    P.Transparency=0.5
    P.BrickColor=BrickColor.new("Bright blue")
    P.Material=Enum.Material.Neon
    P.Parent=workspace
    
    Debris:AddItem(P,0.3)
    
    task.wait(0.15)
    isTeleporting = false
    if gotoEnemies then
        status.Text = "Goto: ON"
    else
        status.Text = "Goto: OFF"
    end
end

local function Q()
    local R=LocalPlayer.Character
    if not R then return end
    local S=R:FindFirstChild("HumanoidRootPart")
    if not S then return end
    local T=R:FindFirstChild("Humanoid")
    if not T then return end
    
    local jumpPos = S.Position
    local safePos, dir = findSafePosition(jumpPos, jumpPos)
    
    if (safePos - jumpPos).Magnitude > 1 then
        S.CFrame = CFrame.new(safePos, safePos + dir)
    end
    
    task.wait(0.1)
    T.Jump=true
    
    local V=Instance.new("Part")
    V.Size=Vector3.new(1.5, 1.5, 1.5)
    V.Position=jumpPos
    V.Anchored=true
    V.CanCollide=false
    V.Transparency=0.5
    V.BrickColor=BrickColor.new("Bright yellow")
    V.Material=Enum.Material.Neon
    V.Parent=workspace
    
    Debris:AddItem(V,0.3)
end

local function W()
    local X=LocalPlayer
    local Y=X:FindFirstChild("Team")
    if not Y then return nil end
    
    local Z=Y.TeamColor
    local _={}
    
    for a0,a1 in ipairs(Players:GetPlayers()) do
        if a1~=X and a1.Character then
            local a2=a1:FindFirstChild("Team")
            if a2 then
                if a2.TeamColor~=Z then
                    table.insert(_,a1)
                end
            end
        end
    end
    
    return _
end

local function a3()
    if not autoDodge then return end
    local G=tick()
    if G-lastActionTime<COOLDOWN then return end
    
    local a4=LocalPlayer.Character
    if not a4 then return end
    local a5=a4:FindFirstChild("HumanoidRootPart")
    if not a5 then return end
    
    local a6=a5.Position
    
    for a7,a8 in ipairs(Players:GetPlayers()) do
        if a8~=LocalPlayer and a8.Character then
            local a9=false
            for aa,ab in ipairs(a8.Character:GetChildren()) do
                if ab:IsA("Tool") and (ab.Name:lower():find("bomb") or ab.Name:lower():find("explosive")) then
                    a9=true
                    break
                end
            end
            
            if a9 then
                local ac=a8.Character:FindFirstChild("HumanoidRootPart")
                if ac then
                    local ad=(a6-ac.Position).Magnitude
                    if ad<=DETECTION_RADIUS then
                        if autoDodge then
                            Q()
                        end
                        lastActionTime=G
                        break
                    end
                end
            end
        end
    end
end

RunService.Heartbeat:Connect(function()
    local ae=tick()
    if ae-lastActionTime<COOLDOWN then return end
    
    local af=LocalPlayer.Character
    if not af then return end
    local ag=af:FindFirstChild("HumanoidRootPart")
    if not ag then return end
    
    local ah=ag.Position
    
    if gotoEnemies then
        local ai=W()
        if #ai>0 then
            for aj,ak in ipairs(ai) do
                if ak.Character then
                    local al=ak.Character:FindFirstChild("HumanoidRootPart")
                    if al then
                        local am=(ah-al.Position).Magnitude
                        if am<=DETECTION_RADIUS then
                            E(al.Position)
                            break
                        end
                    end
                end
            end
        end
    end
    
    a3()
end)

LocalPlayer.CharacterAdded:Connect(function()
    lastActionTime=0
    task.wait(1)
    if screenGui then
        screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
    end
end)
